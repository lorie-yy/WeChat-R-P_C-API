{% extends "wechatfans/common/common.html" %}
{% load i18n %}
{% load static %}
{% block main %}
    <style>
    .data-inline{
        display: inline-flex;
        margin-bottom: 25px;
    }
    .data-inline .data-table{
        display: table;
        height: 60px;
        background-color: #fff;
        margin-right: 25px;
        text-align: center;
        width: 160px;
    }
    .data-inline .data-table div{
        display: table-cell;
        width:35px;
        background-color: #00838f
    }
    .data-inline .data-table dl{
        margin: 0;
        padding: 10px 0;
    }
    </style>
    {% if sc_userlevel == 1 %}
    <div class="data-inline">
        <div class="data-table">
            <div style="background-color: #FF8762"></div>
            <dl>
                <span>今日收益￥</span>
                <dt style="color: #FF8762">{{ todayprofit }}</dt>
            </dl>
        </div>
        <div class="data-table">
            <div style="background-color: #56BDDE"></div>
            <dl>
                <span>总收益￥</span>
                <dt style="color: #56BDDE">{{ totalprofit }}</dt>
            </dl>
        </div>
        <div class="data-table">
            <div style="background-color: #B198DC"></div>
            <dl>
                <span>今日粉丝(人)</span>
                <dt style="color: #B198DC">{{ todayfans }}</dt>
            </dl>
        </div>
        <div class="data-table">
            <div style="background-color: #FEC400"></div>
            <dl>
                <span>总粉丝(人)</span>
                <dt style="color: #FEC400">{{ totalfans }}</dt>
            </dl>
        </div>
        <div class="data-table">
            <div style="background-color: #71CE34"></div>
            <dl>
                <span>可提现￥</span>
                <dt style="color: #71CE34">{{ takemoney }}</dt>
            </dl>
        </div>
    </div>
    <div style="padding: 10px 0;float: right;margin-right: 50px;">
        <a href="takemoney.html" class="btn btn-info btn-tixian" style="padding:9px 20px;top: -10px;">提现</a>
    </div>
    
    <div class="data-chart">
        <div class="panel">
            <div class="panel-heading">
                <span>收益统计</span>
{#                <div style="width: 25%;float: right;top: -10px;position: relative" class="input-group">#}
{#                    <input class="form-control" type="text" placeholder="请选择日期范围" name="daterange" id="daterange">#}
{#                    <span class="input-group-addon btn">查询</span>#}
{#                </div>#}
            </div>
            <div class="panel-body">
                <div id="main" style="height:400px;"></div>
            </div>
            <script type="text/javascript">
                $(function() {
{#                    //日期范围选择器#}
{#                    var daterange1=$('#daterange');#}
{#                    daterange1.daterangepicker({#}
{#                        autoUpdateInput: false,#}
{#                        locale: {format: 'YYYY-MM-DD'}#}
{#                    });#}
{#                    daterange1.on('apply.daterangepicker', function(ev, picker) {#}
{#                        $(this).val(picker.startDate.format('YYYY-MM-DD') + ' - ' + picker.endDate.format('YYYY-MM-DD'));#}
{#                    });#}
{#                    daterange1.on('cancel.daterangepicker', function() {#}
{#                        $(this).val('');#}
{#                    });#}

                    var xdata={{ xdata|safe }};
                    var seriesdata={{ seriesdata }};
                    var seriesdatafans={{ seriesdatafans }};
{#                    console.log(xdata);#}
{#                    console.log(seriesdata);#}
{#                    var startDate=$('input[name=daterangepicker_start]').val();#}
{#                    var endDate=$('input[name=daterangepicker_end]').val();#}

                //折线图
{#                $.ajax({#}
{#                    url:"/wechatfans/showfans",#}
{#                    type: 'GET',#}
{#                    dataType: 'json',#}
{#                    data: {'begin':startDate,'end':endDate},#}
{#                    success:function(data){#}
                        // 基于准备好的dom，初始化echarts实例,定义折线图显示的位置对象
                        // 初始化图表，注意这里不能用JQuery方式，否则会无法初始化
                        var myChart = echarts.init(document.getElementById('main'));
                        // 指定图表的配置项和数据
                        var option = {
                            title: {
                                //text: '粉丝收益统计'
                            },
                            //工具提示
                            tooltip: {
                                trigger: 'axis',
{#                                //点击隐藏某一图例，数据为空时，鼠标悬浮交互时的信息提示有问题#}
{#                                formatter: #}
{#                                '{b}<br/>' +#}
{#                                '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:#56BDDE;"></span>{a0}：{c0} 元<br/>' +#}
{#                                '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:#FEC400;"></span>{a1}：{c1} 人'#}
                            },
                            //图例
                            legend: {
                                data:['收益量(￥)','粉丝量(人)']
                            },
                            //网格位置
                            grid: {
                                left: '3%',
                                right: '4%',
                                bottom: '3%',
                                containLabel: true
                            },
                            toolbox: {
                                show : true,
                                right:'20px',
                                feature : {
                                    mark : {show: true},
                                    magicType : {show: true, type: ['bar','line']},
                                    dataView : {show: true, readOnly: false},
                                    restore : {show: true},
                                    saveAsImage : {show: true}
                                }
                            },
                            calculable : true,
                            xAxis: {
                                type: 'category',
                                boundaryGap: false,
                                data: xdata,
                                axisLabel:{
{#                                    rotate:45, //刻度旋转45度角#}
                                    textStyle:{
{#                                        color:"#0099cc",#}
                                        fontSize:12
                                    }
                                }
                            },
                            yAxis: {
                                type: 'value',
                                axisLabel : {
                                    formatter: '{value}'
                                }
                            },
                            series: [
                                {
                                    name:'收益量(￥)',
                                    type:'line',
                                    data:seriesdata,
                                    markPoint : {
                                        data : [
                                            {type : 'max', name: '最大值'},
                                            {type : 'min', name: '最小值'}

                                        ]
                                    },
                                    markLine : {
                                        data : [
                                            {type : 'average', name : '平均值'}
                                        ]
                                    },
                                    //连线平滑
                                    smooth:true,
                                    itemStyle : {
                                        normal : {
                                            color:'#56BDDE',
{#                                            //连线样式#}
{#                                            lineStyle:{#}
{#                                                color:'#0099cc'#}
{#                                            }#}
                                        }
                                    }
                                },
                                {
                                    name:'粉丝量(人)',
                                    type:'line',
                                    data:seriesdatafans,
                                    markPoint : {
                                        data : [
                                            {type : 'max', name: '最大值'},
                                            {type : 'min', name: '最小值'}

                                        ]
                                    },
                                    markLine : {
                                        data : [
                                            {type : 'average', name : '平均值'}
                                        ]
                                    },
                                    //连线平滑
                                    smooth:true,
                                    itemStyle : {
                                        normal : {
                                            color:'#FEC400',
{#                                            //连线样式#}
{#                                            lineStyle:{#}
{#                                                color:'#0099cc'#}
{#                                            }#}
                                        }
                                    }
                                }
                            ]
                        };
                        // 最后使用指定的配置项和数据加载图表。
                        myChart.setOption(option);

{#                    },#}
{#                    error:function(data){#}
{#                        layer.msg('error')#}
{#                    }#}
{#                });#}
                });
            </script>
        </div>
    </div>
    {% elif sc_userlevel == 2 %}
    <div class="data-inline">
        <div class="data-table">
            <div style="background-color: #FF8762"></div>
            <dl>
                <span>总收益￥</span>
                <dt style="color: #FF8762">{{ totalincome }}</dt>
            </dl>
        </div>
        <div class="data-table">
            <div style="background-color: #B198DC"></div>
            <dl>
                <span>已提现￥</span>
                <dt style="color: #B198DC">{{ cashed  }}</dt>
            </dl>
        </div>
        <div class="data-table">
            <div style="background-color: #FEC400"></div>
            <dl>
                <span>正在提现￥</span>
                <dt style="color: #FEC400">{{ applying }}</dt>
            </dl>
        </div>
        <div class="data-table">
            <div style="background-color: #71CE34"></div>
            <dl>
                <span>可提现￥</span>
                <dt style="color: #71CE34">{{ availablecash }}</dt>
            </dl>
        </div>
    </div>
    <div style="padding: 10px 0;float: right;margin-right: 250px;">
        <a href="takemoney.html" class="btn btn-info btn-tixian" style="padding:9px 20px;top: -10px;">提现</a>
    </div>
    <div class="panel">
        <div class="panel-heading">
            <span>提现记录</span>
        </div>
        <div class="panel-body">
            <div id="apply_records_reload">
                <table id="apply_records" class="table table-condensed table-hover table-striped table-bordered" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th>提现金额(元)</th>
                            <th>提现时间</th>
                            <th>提现方式</th>
                            <th>账号</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody class="middle-align">
                        {% for record in recordslist %}
                        <tr>
                            <td>{{ record.getmoney }}</td>
                            <td>{{ record.applyfortime }}</td>
                            <td>{% if record.paymentmode == 1 %}支付宝{% else %}银行卡{% endif%}</td>
                            <td>{% if record.paymentmode == 1 %}{{ record.alipaynum }}{% else %}{{ record.banknum }}{% endif%}</td>
                            <td>
                                {% if record.paymentresult == 103 %}<span class="special-color">审核中...</span>
                                {% elif record.paymentresult == 101 %}提现成功
                                {% elif record.paymentresult == 102 %}<span style="color:orange">提现失败</span>{% endif%}
                            </td>
                            <td>
                                <a onclick="closerecord({{ record.id }})" {% if record.paymentresult != 103 %}disabled {% endif %} class="btn btn-default btn-xs">关闭</a>
                            </td>
                            <script>
                                function closerecord(id){
                                    var btnSn=function(){
                                        $.ajax({
                                            url: "wechatfans/closerecord",
                                            method: 'GET',
                                            dataType: 'json',
                                            data: {'id':id},
                                            success: function(result){
                                                if (result.result==1){
                                                    layer.msg('已关闭!',function(){
                                                        window.location.reload()
                                                    });
                                                }else if(result.result==2){
                                                    layer.msg('操作失败!')
                                                }
                                            },
                                            error:function(result){
                                                layer.msg('error')
                                            }
                                        });
                                    };
                                    layer.confirm('确定要关闭此申请吗?',{title:'确认'},btnSn)
                                }
                            </script>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>暂无提现记录</tr>
                    </tbody>
                </table>
            </div>
            <div class="form-group">
                <a href="javascript:history.back()" class="btn btn-default" style="float: right">返回</a>
            </div>
        </div>
        </div>
    {% endif %}
{% endblock %}